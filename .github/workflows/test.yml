name: Testing (iOS)

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  frontend_tests:
    runs-on: macos-latest  # iOS simulators require macOS

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20.11'

      - name: Install Frontend Dependencies
        working-directory: ./frontend
        run: npm install

      # Download the Expo IPA (or zipped .app) into the bin folder.
      # Update the URL below with your actual Expo IPA/ZIP download link.
      - name: Download Expo IPA for Detox
        working-directory: ./frontend
        run: |
          mkdir -p bin
          curl -L https://example.com/path-to/Exponent.app.zip -o bin/Exponent.app.zip
          unzip -q bin/Exponent.app.zip -d bin/

      # Optionally, if your project requires starting the Expo server,
      # you can add a step here or use expo-detox-hook.
      #- name: Start Expo server (if needed)
      #- run: |
      #-   expo start --non-interactive &

      - name: Build Detox App
        working-directory: ./frontend
        run: detox build --configuration ios.sim

      - name: Run Detox Tests
        working-directory: ./frontend
        run: detox test --configuration ios.sim
